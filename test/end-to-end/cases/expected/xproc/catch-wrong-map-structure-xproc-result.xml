<?xml version="1.0" encoding="UTF-8"?>
<report xmlns="http://www.jenitennison.com/xslt/xspec"
        xspec="../../catch-wrong-map-structure-xproc.xspec"
        xproc="../../../../xproc/cases/library-dynamic-errors.xpl"
        date="2000-01-01T00:00:00Z">
   <scenario id="scenario1" xspec="../../catch-wrong-map-structure-xproc.xspec">
      <label>Scenario configured to catch errors</label>
      <scenario id="scenario1-scenario1"
                xspec="../../catch-wrong-map-structure-xproc.xspec">
         <label>Error in SUT;</label>
         <input-wrap xmlns="">
            <x:call xmlns:s="x-urn:test:xproc:steplibrary"
                    xmlns:x="http://www.jenitennison.com/xslt/xspec"
                    step="s:p-error">
               <x:option name="error-msg" select="'Something went wrong'"/>
            </x:call>
         </input-wrap>
         <scenario id="scenario1-scenario1-scenario1"
                   xspec="../../catch-wrong-map-structure-xproc.xspec">
            <label>x:expect written with expectation of error</label>
            <result select="/*">
               <content-wrap xmlns="">
                  <pseudo-map xmlns="http://www.jenitennison.com/xslt/xspec">map{"err":map{"column-number":73,"line-number":8,"module":"library-dynamic-errors.xpl","code":Q{x-urn:test:xproc:steplibrary}error-from-my-xproc-step,"value":&lt;c:errors xmlns:c="http://www.w3.org/ns/xproc-step"
          xmlns:cx="http://xmlcalabash.com/ns/extensions"
          xmlns:p="http://www.w3.org/ns/xproc"
          xmlns:s="x-urn:test:xproc:steplibrary"&gt;
   &lt;c:error name="s-p-error"
            type="p:error"
            code="s:error-from-my-xproc-step"
            href="library-dynamic-errors.xpl"
            line="8"
            column="73"&gt;
      &lt;cx:input-location href="library-dynamic-errors.xpl"/&gt;
      &lt;cx:message&gt;(no message for error)&lt;/cx:message&gt;
      &lt;s:document xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;Something went wrong&lt;/s:document&gt;
      &lt;cx:stack-trace&gt;
         &lt;cx:stack-frame type="p:error" name="s-p-error"/&gt;
      &lt;/cx:stack-trace&gt;
   &lt;/c:error&gt;
&lt;/c:errors&gt;
,"description":()}}</pseudo-map>
               </content-wrap>
            </result>
            <test id="scenario1-scenario1-scenario1-expect1" successful="true">
               <label>? twice</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?err?code"/>
               </expect-test-wrap>
               <result select="QName('x-urn:test:xproc:steplibrary', 's:error-from-my-xproc-step')"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario1-scenario1-expect2" successful="true">
               <label>?, !., function notation</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?err!.('code')"/>
               </expect-test-wrap>
               <result select="QName('x-urn:test:xproc:steplibrary', 's:error-from-my-xproc-step')"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario1-scenario1-expect3" successful="true">
               <label>Function notation, ?</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('err')?code"/>
               </expect-test-wrap>
               <result select="QName('x-urn:test:xproc:steplibrary', 's:error-from-my-xproc-step')"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario1-scenario1-expect4" successful="true">
               <label>Function notation twice with !. in between</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('err')!.('code')"/>
               </expect-test-wrap>
               <result select="QName('x-urn:test:xproc:steplibrary', 's:error-from-my-xproc-step')"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
         </scenario>
         <scenario id="scenario1-scenario1-scenario2"
                   xspec="../../catch-wrong-map-structure-xproc.xspec">
            <label>x:expect written with expectation of no error</label>
            <result select="/*">
               <content-wrap xmlns="">
                  <pseudo-map xmlns="http://www.jenitennison.com/xslt/xspec">map{"err":map{"column-number":73,"line-number":8,"module":"library-dynamic-errors.xpl","code":Q{x-urn:test:xproc:steplibrary}error-from-my-xproc-step,"value":&lt;c:errors xmlns:c="http://www.w3.org/ns/xproc-step"
          xmlns:cx="http://xmlcalabash.com/ns/extensions"
          xmlns:p="http://www.w3.org/ns/xproc"
          xmlns:s="x-urn:test:xproc:steplibrary"&gt;
   &lt;c:error name="s-p-error"
            type="p:error"
            code="s:error-from-my-xproc-step"
            href="library-dynamic-errors.xpl"
            line="8"
            column="73"&gt;
      &lt;cx:input-location href="library-dynamic-errors.xpl"/&gt;
      &lt;cx:message&gt;(no message for error)&lt;/cx:message&gt;
      &lt;s:document xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;Something went wrong&lt;/s:document&gt;
      &lt;cx:stack-trace&gt;
         &lt;cx:stack-frame type="p:error" name="s-p-error"/&gt;
      &lt;/cx:stack-trace&gt;
   &lt;/c:error&gt;
&lt;/c:errors&gt;
,"description":()}}</pseudo-map>
               </content-wrap>
            </result>
            <test id="scenario1-scenario1-scenario2-expect1" successful="false">
               <label>? three times</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?ports?xproc-result?document"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario1-scenario2-expect2" successful="false">
               <label>?, !. preceding function notation</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?ports!.('xproc-result')!.('document')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario1-scenario2-expect3" successful="false">
               <label>Function notation, ?</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('ports')?xproc-result?document"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario1-scenario2-expect4" successful="false">
               <label>Function notation with !. preceding all but first</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('ports')!.('xproc-result')!.('document')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
         </scenario>
      </scenario>
      <scenario id="scenario1-scenario2"
                xspec="../../catch-wrong-map-structure-xproc.xspec">
         <label>No error in SUT, which has output port;</label>
         <input-wrap xmlns="">
            <x:call xmlns:s="x-urn:test:xproc:steplibrary"
                    xmlns:x="http://www.jenitennison.com/xslt/xspec"
                    step="s:p-error-or-document"/>
         </input-wrap>
         <scenario id="scenario1-scenario2-scenario1"
                   xspec="../../catch-wrong-map-structure-xproc.xspec">
            <label>x:expect written with expectation of no error</label>
            <result select="/*">
               <content-wrap xmlns="">
                  <pseudo-map xmlns="http://www.jenitennison.com/xslt/xspec">map{"ports":map{"xproc-result":map{"document-properties":map{Q{}base-uri:"library-dynamic-errors.xpl?uniqueid=3",Q{}content-type:"application/xml"},"document":&lt;no-errors xmlns:s="x-urn:test:xproc:steplibrary"
           xmlns:xs="http://www.w3.org/2001/XMLSchema"/&gt;
}}}</pseudo-map>
               </content-wrap>
            </result>
            <test id="scenario1-scenario2-scenario1-expect1" successful="true">
               <label>? three times</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?ports?xproc-result?document"/>
               </expect-test-wrap>
               <result select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
                  </content-wrap>
               </result>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario2-scenario1-expect2" successful="true">
               <label>?, !. preceding function notation</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?ports!.('xproc-result')!.('document')"/>
               </expect-test-wrap>
               <result select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
                  </content-wrap>
               </result>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario2-scenario1-expect3" successful="true">
               <label>Function notation, ?</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('ports')?xproc-result?document"/>
               </expect-test-wrap>
               <result select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
                  </content-wrap>
               </result>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario2-scenario1-expect4" successful="true">
               <label>Function notation with !. preceding all but first</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('ports')!.('xproc-result')!.('document')"/>
               </expect-test-wrap>
               <result select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:xs="http://www.w3.org/2001/XMLSchema"/>
                  </content-wrap>
               </result>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
         </scenario>
         <scenario id="scenario1-scenario2-scenario2"
                   xspec="../../catch-wrong-map-structure-xproc.xspec">
            <label>x:expect written with expectation of error</label>
            <result select="/*">
               <content-wrap xmlns="">
                  <pseudo-map xmlns="http://www.jenitennison.com/xslt/xspec">map{"ports":map{"xproc-result":map{"document-properties":map{Q{}base-uri:"library-dynamic-errors.xpl?uniqueid=3",Q{}content-type:"application/xml"},"document":&lt;no-errors xmlns:s="x-urn:test:xproc:steplibrary"
           xmlns:xs="http://www.w3.org/2001/XMLSchema"/&gt;
}}}</pseudo-map>
               </content-wrap>
            </result>
            <test id="scenario1-scenario2-scenario2-expect1" successful="false">
               <label>? twice</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?err?code"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario2-scenario2-expect2" successful="false">
               <label>?, !., function notation</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?err!.('code')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario2-scenario2-expect3" successful="false">
               <label>Function notation, ?</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('err')?code"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario2-scenario2-expect4" successful="false">
               <label>Function notation twice with !. in between</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('err')!.('code')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
         </scenario>
      </scenario>
      <scenario id="scenario1-scenario3"
                xspec="../../catch-wrong-map-structure-xproc.xspec">
         <label>No error in SUT, which has no output ports;</label>
         <input-wrap xmlns="">
            <x:call xmlns:s="x-urn:test:xproc:steplibrary"
                    xmlns:x="http://www.jenitennison.com/xslt/xspec"
                    step="s:p-error"/>
         </input-wrap>
         <scenario id="scenario1-scenario3-scenario1"
                   xspec="../../catch-wrong-map-structure-xproc.xspec">
            <label>x:expect written with expectation of no error</label>
            <result select="/*">
               <content-wrap xmlns="">
                  <pseudo-map xmlns="http://www.jenitennison.com/xslt/xspec">map{"ports":map{}}</pseudo-map>
               </content-wrap>
            </result>
            <test id="scenario1-scenario3-scenario1-expect1" successful="false">
               <label>? three times</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?ports?xproc-result?document"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario3-scenario1-expect2" successful="false">
               <label>?, !. preceding function notation</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?ports!.('xproc-result')!.('document')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario3-scenario1-expect3" successful="false">
               <label>Function notation, ?</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('ports')?xproc-result?document"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
            <test id="scenario1-scenario3-scenario1-expect4" successful="false">
               <label>Function notation with !. preceding all but first</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('ports')!.('xproc-result')!.('document')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="/self::document-node()">
                  <content-wrap xmlns="">
                     <no-errors xmlns:s="x-urn:test:xproc:steplibrary"
                                xmlns:x="http://www.jenitennison.com/xslt/xspec"/>
                  </content-wrap>
               </expect>
            </test>
         </scenario>
         <scenario id="scenario1-scenario3-scenario2"
                   xspec="../../catch-wrong-map-structure-xproc.xspec">
            <label>x:expect written with expectation of error</label>
            <result select="/*">
               <content-wrap xmlns="">
                  <pseudo-map xmlns="http://www.jenitennison.com/xslt/xspec">map{"ports":map{}}</pseudo-map>
               </content-wrap>
            </result>
            <test id="scenario1-scenario3-scenario2-expect1" successful="false">
               <label>? twice</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?err?code"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario3-scenario2-expect2" successful="false">
               <label>?, !., function notation</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result?err!.('code')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario3-scenario2-expect3" successful="false">
               <label>Function notation, ?</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('err')?code"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
            <test id="scenario1-scenario3-scenario2-expect4" successful="false">
               <label>Function notation twice with !. in between</label>
               <expect-test-wrap xmlns="">
                  <x:expect xmlns:s="x-urn:test:xproc:steplibrary"
                            xmlns:x="http://www.jenitennison.com/xslt/xspec"
                            test="$x:result('err')!.('code')"/>
               </expect-test-wrap>
               <result select="()"/>
               <expect select="QName('x-urn:test:xproc:steplibrary', 'error-from-my-xproc-step')"/>
            </test>
         </scenario>
      </scenario>
   </scenario>
</report>
