<?xml version="1.0" encoding="UTF-8"?>
<x:description preserve-space="pre" stylesheet="xspec-space.xsl"
	xmlns:x="http://www.jenitennison.com/xslt/xspec" xmlns:xspec-space="x-urn:test:xspec-space">

	<!--
		xspec-sch.xspec uses this file for testing ../src/schemas/xspec.sch.
		When modifying this file, check whether xspec-sch.xspec needs any additions or updates.
	-->

	<x:scenario
		label="In context template-param, whitespace-only text nodes in user-content are removed by default.">
		<x:scenario>
			<x:label>So, in
				//x:context/x:param/element()[not(ancestor-or-self::element()/@xml:space)],
				whitespace-only text nodes are removed.</x:label>
			<x:context mode="param-mirror-mode">
				<x:param name="param-items">
					<span>&#x09;&#x0A;&#x0D;&#x20;</span>
				</x:param>
				<foo />
			</x:context>
			<x:expect label="(verified via $x:result)"
				test="deep-equal($x:result, $xspec-space:span-element-empty)" />
			<x:expect label="(verified via wrapper document)"
				test="deep-equal(node(), $xspec-space:span-element-empty)" />
		</x:scenario>

		<x:scenario label="But...">
			<x:scenario>
				<x:label>@xml:space overrides the default. So, in
					//x:context/x:param/element()[ancestor-or-self::element()[@xml:space][1]/@xml:space
					= "preserve"], whitespace-only text nodes are kept.</x:label>
				<x:context mode="param-mirror-mode">
					<x:param name="param-items" xml:space="preserve"><span>&#x09;&#x0A;&#x0D;&#x20;</span></x:param>
					<foo />
				</x:context>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:span-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:span-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>node-selection @href is always intact. So, in
					//x:context/x:param/@href[not(ancestor::element()/@xml:space)]/doc(.)[not(descendant::element()/@xml:space)],
					whitespace-only text nodes are kept.</x:label>
				<x:context mode="param-mirror-mode">
					<x:param href="xspec-space.xml" name="param-items" />
					<foo />
				</x:context>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result/node(), $xspec-space:span-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:span-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>Elements specified by @preserve-space are intact. So, in
					//x:context/x:param/element()[not(ancestor-or-self::element()/@xml:space)][node-name(.)
					= (for $qname in tokenize(/x:description/@preserve-space, '\s+') return
					resolve-QName($qname, /x:description))], whitespace-only text nodes are
					kept.</x:label>
				<x:context mode="param-mirror-mode">
					<x:param name="param-items">
						<pre>&#x09;&#x0A;&#x0D;&#x20;</pre>
					</x:param>
					<foo />
				</x:context>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:pre-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:pre-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>Text nodes created by x:text are intact. So, in
					//x:context/x:param/x:text[not(ancestor-or-self::element()/@xml:space)],
					whitespace-only text nodes are kept.</x:label>
				<x:context mode="param-mirror-mode">
					<x:param name="param-items">
						<x:text>&#x09;&#x0A;&#x0D;&#x20;</x:text>
					</x:param>
					<foo />
				</x:context>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:wsot)" />
			</x:scenario>
		</x:scenario>
	</x:scenario>

	<x:scenario
		label="In context, whitespace-only text nodes in user-content are removed by default.">
		<x:scenario>
			<x:label>So, in //x:context/element()[namespace-uri() ne
				'http://www.jenitennison.com/xslt/xspec'][not(ancestor-or-self::element()/@xml:space)],
				whitespace-only text nodes are removed.</x:label>
			<x:context>
				<span>&#x09;&#x0A;&#x0D;&#x20;</span>
			</x:context>
			<x:call template="context-mirror-template" />
			<x:expect label="(verified via $x:result)"
				test="deep-equal($x:result, $xspec-space:span-element-empty)" />
			<x:expect label="(verified via wrapper document)"
				test="deep-equal(node(), $xspec-space:span-element-empty)" />
		</x:scenario>

		<x:scenario label="But...">
			<x:scenario>
				<x:label>@xml:space overrides the default. So, in
					//x:context/element()[namespace-uri() ne
					'http://www.jenitennison.com/xslt/xspec'][ancestor-or-self::element()[@xml:space][1]/@xml:space
					= "preserve"], whitespace-only text nodes are kept.</x:label>
				<x:context xml:space="preserve"><span>&#x09;&#x0A;&#x0D;&#x20;</span></x:context>
				<x:call template="context-mirror-template" />
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:span-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:span-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>node-selection @href is always intact. So, in
					//x:context/@href[not(ancestor::element()/@xml:space)]/doc(.)[not(descendant::element()/@xml:space)],
					whitespace-only text nodes are kept.</x:label>
				<x:context href="xspec-space.xml" />
				<x:call template="context-mirror-template" />
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result/node(), $xspec-space:span-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:span-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>Elements specified by @preserve-space are intact. So, in
					//x:context/element()[not(ancestor-or-self::element()/@xml:space)][node-name(.)
					= (for $qname in tokenize(/x:description/@preserve-space, '\s+') return
					resolve-QName($qname, /x:description))], whitespace-only text nodes are
					kept.</x:label>
				<x:context>
					<pre>&#x09;&#x0A;&#x0D;&#x20;</pre>
				</x:context>
				<x:call template="context-mirror-template" />
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:pre-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:pre-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>Text nodes created by x:text are intact. So, in
					//x:context/x:text[not(ancestor-or-self::element()/@xml:space)], whitespace-only
					text nodes are kept.</x:label>
				<x:context>
					<x:text>&#x09;&#x0A;&#x0D;&#x20;</x:text>
				</x:context>
				<x:call template="context-mirror-template" />
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:wsot)" />
			</x:scenario>
		</x:scenario>
	</x:scenario>

	<x:scenario
		label="In template-call template-param, whitespace-only text nodes in user-content are removed by default.">
		<x:scenario>
			<x:label>So, in
				//x:call[@template]/x:param/element()[not(ancestor-or-self::element()/@xml:space)],
				whitespace-only text nodes are removed.</x:label>
			<x:call template="param-mirror-template">
				<x:param name="param-items">
					<span>&#x09;&#x0A;&#x0D;&#x20;</span>
				</x:param>
			</x:call>
			<x:expect label="(verified via $x:result)"
				test="deep-equal($x:result, $xspec-space:span-element-empty)" />
			<x:expect label="(verified via wrapper document)"
				test="deep-equal(node(), $xspec-space:span-element-empty)" />
		</x:scenario>

		<x:scenario label="But...">
			<x:scenario>
				<x:label>@xml:space overrides the default. So, in
					//x:call[@template]/x:param/element()[ancestor-or-self::element()[@xml:space][1]/@xml:space
					= "preserve"], whitespace-only text nodes are kept.</x:label>
				<x:call template="param-mirror-template">
					<x:param name="param-items" xml:space="preserve"><span>&#x09;&#x0A;&#x0D;&#x20;</span></x:param>
				</x:call>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:span-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:span-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>node-selection @href is always intact. So, in
					//x:call[@template]/x:param/@href[not(ancestor::element()/@xml:space)]/doc(.)[not(descendant::element()/@xml:space)],
					whitespace-only text nodes are kept.</x:label>
				<x:call template="param-mirror-template">
					<x:param href="xspec-space.xml" name="param-items" />
				</x:call>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result/node(), $xspec-space:span-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:span-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>Elements specified by @preserve-space are intact. So, in
					//x:call[@template]/x:param/element()[not(ancestor-or-self::element()/@xml:space)][node-name(.)
					= (for $qname in tokenize(/x:description/@preserve-space, '\s+') return
					resolve-QName($qname, /x:description))], whitespace-only text nodes are
					kept.</x:label>
				<x:call template="param-mirror-template">
					<x:param name="param-items">
						<pre>&#x09;&#x0A;&#x0D;&#x20;</pre>
					</x:param>
				</x:call>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:pre-element-wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:pre-element-wsot)" />
			</x:scenario>

			<x:scenario>
				<x:label>Text nodes created by x:text are intact. So, in
					//x:call[@template]/x:param/x:text[not(ancestor-or-self::element()/@xml:space)],
					whitespace-only text nodes are kept.</x:label>
				<x:call template="param-mirror-template">
					<x:param name="param-items">
						<x:text>&#x09;&#x0A;&#x0D;&#x20;</x:text>
					</x:param>
				</x:call>
				<x:expect label="(verified via $x:result)"
					test="deep-equal($x:result, $xspec-space:wsot)" />
				<x:expect label="(verified via wrapper document)"
					test="deep-equal(node(), $xspec-space:wsot)" />
			</x:scenario>
		</x:scenario>
	</x:scenario>

</x:description>
