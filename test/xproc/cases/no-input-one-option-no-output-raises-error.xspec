<?xml version="1.0" encoding="UTF-8"?>
<?xspec-test min-xmlcalabash-version=3.0.31?>
<x:description xmlns:s="x-urn:test:xproc:steplibrary"
    xmlns:x="http://www.jenitennison.com/xslt/xspec" xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xproc="library.xpl">
    <x:scenario label="Step does not raise error">
        <x:call step="s:no-input-one-option-no-output-raises-error"/>
        <x:expect select="map{'ports': map{}}"
            result-type="map(xs:string, map(empty-sequence(), empty-sequence()))">
            <x:label>No error. Result map's 'ports' value is an empty map because the step has no
                output ports.</x:label>
        </x:expect>

    </x:scenario>
    <x:scenario label="Step raises error using p:error" catch="yes">
        <x:call step="s:no-input-one-option-no-output-raises-error">
            <x:option name="error-msg" select="'Something went wrong'"/>
        </x:call>
        <x:expect label="Check error code" result-type="map(xs:string, map(xs:string, item()*))"
            test="$x:result?err?code" select="QName('', 'error-from-my-xproc-step')"/>
        <x:expect label="Error description is a string"
            result-type="map(xs:string, map(xs:string, item()*))"
            test="$x:result?err?description instance of xs:string"/>
        <x:expect label="that, when parsed as XML, equals the source document of p:error."
            result-type="map(xs:string, map(xs:string, item()*))"
            test="$x:result?err?description => parse-xml()" select="/">
            <document>Something went wrong</document>
        </x:expect>
    </x:scenario>
</x:description>
