<?xml version="1.0" encoding="UTF-8"?>
<x:description stylesheet="xspec-catch.xsl" xmlns:x="http://www.jenitennison.com/xslt/xspec"
	xslt-version="3.0">

	<x:scenario label="expect-error" shared="yes">
		<x:expect label="err:code" select="xs:QName('error-code-of-my-template')"
			test="$x:result?err?code treat as xs:QName" />
		<x:expect label="err:description" select="'error description of my template'"
			test="$x:result?err?description treat as xs:string" />
		<x:expect label="err:value" select="'error', 'object', 'of', 'my', 'template'"
			test="$x:result?err?value treat as xs:string+" />

		<!-- The error is raised by fn:error() at a line in the stylesheet being tested -->
		<x:expect label="err:module" select="resolve-uri('xspec-catch.xsl', $x:xspec-uri)"
			test="$x:result?err?module treat as xs:string" />
		<x:expect label="err:line-number" select="14"
			test="$x:result?err?line-number treat as xs:integer" />
		<x:expect label="err:column-number"
			test="($x:result?err?column-number treat as xs:integer) ge 1" />
	</x:scenario>

	<x:scenario label="expect-intact" shared="yes">
		<x:expect label="Generated item intact" select="'string generated by my template'" />
	</x:scenario>

	<x:scenario catch="true" label="Enable @catch">

		<x:scenario label="named-scenario">
			<x:scenario label="without context">
				<x:scenario label="Error in SUT">
					<x:call template="my-template-with-error" />
					<x:like label="expect-error" />
				</x:scenario>

				<x:scenario label="No error in SUT">
					<x:call template="my-template-without-error" />
					<x:like label="expect-intact" />
				</x:scenario>
			</x:scenario>

			<x:scenario label="with context">
				<x:context>
					<context-element-for-my-template />
				</x:context>

				<x:scenario label="Error in SUT">
					<x:call template="my-template-with-error" />
					<x:like label="expect-error" />
				</x:scenario>

				<x:scenario label="No error in SUT">
					<x:call template="my-template-without-error" />
					<x:like label="expect-intact" />
				</x:scenario>
			</x:scenario>
		</x:scenario>

		<x:scenario label="matching-scenario">
			<x:context>
				<context-element-for-my-template />
			</x:context>

			<x:scenario label="Error in SUT">
				<x:context mode="with-error" />
				<x:like label="expect-error" />
			</x:scenario>

			<x:scenario label="No error in SUT">
				<x:context mode="without-error" />
				<x:like label="expect-intact" />
			</x:scenario>
		</x:scenario>

	</x:scenario>

</x:description>
